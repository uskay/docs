---
class: post-blog post-detail
type: Blog
$title: "Contributing to WebKit for a more predictable web platform"
id: ads-contributing-to-webkit-for-a-more-predictable-web-platform
author: amphtml
role: 
origin: "https://amphtml.wordpress.com/2018/12/06/contributing-to-webkit-for-a-more-predictable-web-platform/amp/"
excerpt: "Over the past two years, the AMP Project has been working with Igalia to identify bugs and missing features within iOS WebKit and then fix them. We create repro cases, write web platform tests, perform debugging and analysis, and, of course, write patches to actually fix things. We think this is particular rewarding work, because [&#8230;]"
avatar: https://1.gravatar.com/avatar/42ecb1ea497ca9d0ffe1e406cae70e27?s=96&d=identicon&r=G
date_data: 2018-12-06T08:41:19-08:00
$date: December 6, 2018
$parent: /content/latest/list-blog.html
$path: /latest/blog/{base}/
$localization:
  path: /{locale}/latest/blog/{base}/
components:
  - social-share
inlineCSS: false
---

<div class="amp-wp-article-content">

		<div class="wp-block-image"><figure class="alignright is-resized"><amp-img src="https://amphtml.files.wordpress.com/2018/12/webkit.png?w=258&amp;h=279" alt="" class="wp-image-2299 amp-wp-enforced-sizes" width="258" height="279" srcset="https://amphtml.files.wordpress.com/2018/12/webkit.png?w=258&amp;h=279 258w, https://amphtml.files.wordpress.com/2018/12/webkit.png?w=139&amp;h=150 139w, https://amphtml.files.wordpress.com/2018/12/webkit.png?w=277&amp;h=300 277w, https://amphtml.files.wordpress.com/2018/12/webkit.png 510w" sizes="(min-width: 258px) 258px, 100vw"></amp-img></figure></div><p>Over the past two years, the AMP Project has been working with <a href="https://www.igalia.com/">Igalia</a> to identify bugs and missing features within iOS WebKit and then fix them. We create repro cases, write web platform tests, perform debugging and analysis, and, of course, write patches to actually fix things. We think this is particular rewarding work, because it helps ourselves achieve our goals faster, but also makes the web more predictable for developers overall.<br/></p><p>In this blog post, we provide an overview of the work done in 2018 with hints about when improvements will be available in iOS releases or when they will have to be handled by Apple. Some of this work is still in progress and we keep proposing new ideas and reporting bugs.</p><h2><strong>iOS 12.1</strong></h2><p>We submitted patches for the following bugs which are now fixed in the latest iOS 12.1 releases:</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=183658">Ensuring that the highlighted text of the Find UI is revealed at the middle of the page</a></li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=177684">Allowing to use JavaScript to unset CSS transition properties that have an !important rule</a></li><li>Various fixes for the animation code, including<a href="https://bugs.webkit.org/show_bug.cgi?id=170784"> bug 170784</a> and<a href="https://bugs.webkit.org/show_bug.cgi?id=186129"> bug 186129</a>.</li></ul><p>Additionally, Igalia assisted Apple with improvements to custom elements. This one is fixed in the latest iOS 12.1.1 beta:</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=183583">Not calling connectedCallback when a custom element is disconnected</a>. For other similar use cases such as<a href="https://bugs.webkit.org/show_bug.cgi?id=183586"> bug 183586</a> or<a href="https://github.com/w3c/webcomponents/issues/760"> issue 760</a>, WebKit’s behavior was actually correct.</li></ul><h2><strong>iOS 11</strong></h2><p>We have been watching some improvements and verified that they are included in the latest iOS 11 releases. These two items were handled by Igalia in 2017 thanks to support from the AMP project:</p><ul><li>Improving <a href="http://frederic-wang.fr/amp-and-igalia-working-together-to-improve-the-web-platform.html#frame-sandboxing">frame sandboxing</a>, including implementations of new<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox"> sandbox attribute values</a> such as <em>allow-popup-to-escape-sandbox</em>, <em>allow-top-navigation-without-user-activation</em> and <em>allow-modals</em> flags.<br/>This allows apps to more securely sandbox ads from doing bad things.</li><li>Fixing flickering for fixed positioned elements in iframes when touch scrolling is on. See<a href="https://bugs.webkit.org/show_bug.cgi?id=175135"> bug 175135</a></li></ul><p> These bugs triaged by us were fixed by other WebKit developers:</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=155198">Ensuring that iframe are properly resized on orientation change</a>.</li><li><a href="https://github.com/ampproject/amphtml/issues/11829">Fixing a regression that led to unpainted content for overflow node with touch scrolling enabled</a>.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=166794">Making the “speak selection” feature work in iframes</a>.</li><li>Addressing various issues with scroll snapping. In particular, see<a href="https://bugs.webkit.org/show_bug.cgi?id=160622"> bug 160622</a>,<a href="https://bugs.webkit.org/show_bug.cgi?id=158821"> bug 158821</a> and<a href="https://bugs.webkit.org/show_bug.cgi?id=170560"> bug 170560</a></li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=162562">Preventing swipe gestures on the “play” icon to launch a video</a>.</li><li>Adding support for<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Preloading_content"> link preload</a>. See<a href="https://bugs.webkit.org/show_bug.cgi?id=158720"> bug 158720</a>.</li></ul><h2><strong>WebKit trunk</strong></h2><p>We have collaborated with Igalia’s and Google’s Web Platform engineers to make the following features available in WebKit trunk. Apple does not comment on <a href="https://trac.webkit.org/wiki/FAQ#Releases">future releases</a> but we keep watching them to verify when these improvements arrive in iOS releases.</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=158342">Making overflow nodes with touch scrolling enabled scrollable when their content is dynamically resized to overflow</a>.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=154399">Preventing jumps of fixed positioned elements in iframes when touch scrolling is on.</a></li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=5991">Implementing standard behavior for scroll* APIs on the document root/body</a> so that WebKit matches the behavior of Firefox, Chromium and Edge. This is currently under a preference flag but<a href="https://bugs.webkit.org/show_bug.cgi?id=189472#c11"> Apple is happy to enable it in Safari in the future</a>.</li><li>Supporting<a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API"> Intersection Observer</a> currently well advanced but under a preference flag. See<a href="https://bugs.webkit.org/show_bug.cgi?id=159475"> bug 159475</a>.</li></ul><h2><strong>To be handled by Apple</strong></h2><p>Apple has been working on two big features that are interesting for AMP:</p><ul><li><a href="https://webkit.org/blog/8343/web-animations-in-webkit/">Web Animations</a>, currently under a preference flag which is disabled by default on current iOS releases.</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API">Fullscreen API</a>, currently under a preference flag which is already<a href="https://twitter.com/rmondello/status/1041739671775043596"> enabled for iPad</a></li></ul><p>After analysis and discussions we concluded that it will be up to Apple to fix the following issues:</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=165627">Redirecting window.top to itunes URLs</a> or better handling of the<a href="https://bugs.webkit.org/show_bug.cgi?id=167341"> download attribute</a> both of them involving proprietary code in Safari to decide the application to open the link.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=186127">Preserving transformation matrix when pausing an animation</a> which likely requires change in the proprietary CALayer’s addAnimation.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=134230">Supporting for contentInset by the WKWebView</a> which requires change in WKWebView.</li></ul><h2><strong>Work in progress</strong></h2><p>We are working with Igalia on the following improvements and some patches are already available:</p><ul><li><a href="https://bugs.webkit.org/show_bug.cgi?id=188043">Support smooth ScrollBehavior for scrollIntoView/scrollTo/scrollBy</a>. You can watch<a href="https://vimeo.com/301932304"> this video</a> for a quick demo.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=186593">Allowing to pass user gesture via MessageChannel</a>.</li><li><a href="https://bugs.webkit.org/show_bug.cgi?id=149264">iOS frame scrolling</a>. We are still coordinating with Apple to get the current patch reviewed. You can check<a href="https://vimeo.com/252166689"> the video we made early this year</a>.</li><li>Working on web compatibility fixes in the areas of<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model"> DOM</a>,<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"> XMLHttpRequest</a> and<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"> fetch</a>.</li></ul><h2><strong>Conclusion</strong></h2><p>We are thrilled to continue collaboration with Igalia and other browser developers in order to keep improving WebKit’s web platform implementations. Next year, we plan to continue the effort on the current tasks but we also have various other ideas related to networking, UI and more. Stay tuned!</p><p>Posted by <a href="http://frederic-wang.fr/">Frédéric Wang</a>, browser engineer at <a href="https://www.igalia.com/">Igalia</a></p>	</div>

	

</div>

